<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.uni.wt.workState.model.dao.WorkStateMapper">
 
 <resultMap type="WorkState" id="workStateSet">
 	<result property="work_no" column="WORK_NO"/>
 	<result property="emp_no" column="EMP_NO"/>
 	<result property="in_time" column="IN_TIME"/>
 	<result property="out_time" column="OUT_TIME"/>
 </resultMap>
 
 
 <select id="getSeq" resultType="_int">
 SELECT WS_SEQ.NEXTVAL FROM DUAL
 </select>
 
 <insert id="insertInTime" parameterType="WorkState">
 	INSERT INTO WORK_TIME (WORK_NO, EMP_NO, IN_TIME, OUT_TIME)
 	VALUES(#{work_no}, #{emp_no}, SYSDATE,NULL)
 </insert>
 
 <update id="updateWorkStatus" parameterType="WorkState">
 	UPDATE WORK_STATUS
 	SET STATUS = #{status}
 	WHERE EMP_NO = #{emp_no}
 </update>
 
 <update id="updateOutTime" parameterType="WorkState">
 	UPDATE WORK_TIME
 	SET OUT_TIME = SYSDATE
 	WHERE EMP_NO = #{emp_no}
 	AND WORK_NO = #{work_no}
 </update>
 
 <select id="selectWorkTime" parameterType="_int" resultMap="workStateSet">
 	SELECT 
		WORK_NO,
   		EMP_NO,
    	TO_CHAR(IN_TIME,'HH24:MI:SS') AS IN_TIME,
    	TO_CHAR(OUT_TIME,'HH24:MI:SS') AS out_TIME
 	FROM WORK_TIME
 	WHERE WORK_NO = #{todaySeq}
 </select>
 <select id="selectWorkState" parameterType="string" resultType="string">
 	SELECT STATUS FROM WORK_STATUS
 	WHERE EMP_NO = #{emp_no}
 
 </select>
 
 <select id="selectMyWork" parameterType="map" resultType="map">
 SELECT
	SUM(ROUND((OUT_TIME - IN_TIME)*24)) AS TOTALTIME,
	52-SUM(ROUND((OUT_TIME - IN_TIME)*24)) AS LEFTTIME,
	SUM(ROUND((OUT_TIME - IN_TIME)*24))-52 AS OVERTIME,
	(SELECT 
		SUM(ROUND((OUT_TIME - IN_TIME)*24)) 
	FROM WORK_TIME 
	WHERE TO_CHAR(IN_TIME, 'YYYYMMDD') IN
	<foreach collection="weekHoliday" item="arr" open="(" close=")" separator=",">
	 #{arr}
	</foreach>
	AND EMP_NO = #{emp_no}
	) AS HOLIDAY
FROM WORK_TIME
WHERE IN_TIME BETWEEN TO_DATE(#{startday}, 'YYYYMMDD') AND TO_DATE(#{startday}, 'YYYYMMDD')+7
AND EMP_NO = #{emp_no}
GROUP BY EMP_NO
 
 </select>
 
 <select id="selectWorkTimeList" parameterType="map" resultType="map">
 SELECT
    TO_CHAR(IN_TIME, 'FMMM.DD/HH24') AS WORKDAY,
    ROUND((OUT_TIME-IN_TIME)*24) AS TIMESUM
FROM WORK_TIME
WHERE EMP_NO = #{emp_no}
AND IN_TIME BETWEEN TO_DATE(#{startday}, 'YYYY.MM.DD') AND TO_DATE(#{startday}, 'YYYY.MM.DD')+7
 </select>
 	
</mapper>
